# Проект «Исследуй со мной»

### [Ссылка на Репозиторий](https://github.com/mvinogradovHub/java-explore-with-me/pull/4)

## Идея
Свободное время — ценный ресурс. Ежедневно мы планируем, как его потратить — куда и с кем сходить. Сложнее всего в таком планировании поиск информации и переговоры. Нужно учесть много деталей: какие намечаются мероприятия, свободны ли в этот момент друзья, как всех пригласить и где собраться.
Созданное приложение — афиша. В этой афише можно предложить какое-либо событие от выставки до похода в кино и собрать компанию для участия в нём.

## Состав

* **ewm-service** - основной сервис содердит всё необходимое для работы продукта;
* **ewm-statistics** - сервис статистики хранит количество просмотров и позволит делать различные выборки для анализа работы приложения.

## Схема БД ewm-service
![img](./ewm-service-bd.png)

## Фича для самостоятельного проектирования

### Постановка задачи
Улучшение модерации событий администратором — возможность выгружать все события, ожидающие модерации, делать их проверку, а также оставлять комментарий для инициатора события, если оно не прошло модерацию. При этом у инициатора есть возможность исправить замечания и отправить событие на повторную модерацию.

### Формулирование требований

Исходя из постаноки задачи я выделил следующие требования к разрабатываемой функциональности:
1. администратор может выгружать все события, ожидающие модерации
2. администратор может менять статус события если не прошло модерацию
3. администратор может оставлять комментарий для инициатора события, если оно не прошло модерацию
4. инициатор может исправить замечания, если оно не прошло модерацию
5. инициатор может отправить событие на повторную модерацию.

### Ограничения 
Нельзя создавать новую статусную модель событий т.к. в этом случае не пройдут POSTMAN тесты второго этапа разработки. Причем разработчик не может повлиять на работу этих тестов

### Решение

1. Ожидающие модерацию события имеют статус PENDING. В этот статус событие переходит сразу после создания пользователем. Т.к. у администратора есть метод поиска событий GET /admin/events?states={} с возможностью фильтрации по states, то администратор уже может получить все события, ожидающие модерации. Разработка не требуется.
2. Если событие со статусом PENDING не прошло модерацию, администратор может его отклонить (статус CANCELED). У администратора для этого есть метод PATCH admin/events/{eventId}, передав в теле запроса параметр stateAction = REJECT_EVENT Т.е. требование уже реализовано и делать тут ничего не требуется.
3. При изменении статуса события администратором с помощью метода PATCH admin/events/{eventId} на статус CANCELED, он должен иметь возможность добавить комментарий. Для этого во входной DTO EventUpdateByAdminDto метода PATCH admin/events/{eventId} я добавил поле комментария commentOnRejection. Так как в требованиях четко сказано что комментарий можно добавить только при отклонении, то специально не делал отдельного контроллера для этого, а добавление идет вместе с отменой. Плюс добавлены проверки чтобы нельзя было добавить комментарий при публикации. Также мне показалось что у админа всеже должна быть возможность отредактировать и удалить оставленный комментарий (хоть этого и нет в требованиях), поэтому я добавил эту функциональность отдельными эндпойнтами.
4. Эта функциональность и так есть у пользователя с помощью метода PATCH /users/{userId}/events/{eventId}. Изменив необходимые поля, он может исправить замечания.
5. Эта функциональность и так есть у пользователя с помощью метода PATCH /users/{userId}/events/{eventId}. Указав во входящем объекте stateAction = SEND_TO_REVIEW, он иожет отправить на повторное ревью

### Проверка

Реализована Проверка Postman, которая проверяет выполнение указанных требований:

1. Тесты: 
   1. Получение Администратором событий на модерацию
   2. Получение администратором отклоненных событий с комментарием
2. и 3. Тесты: 
   1. Отклонение с комментарием события администратором 
   2. Повторное отклонение с комментарием события Администратором
4. и 5. Тесты
   1. Отправка пользователем события на повторную модерацию
   2. Повторная отправка пользователем события на повторную модерацию